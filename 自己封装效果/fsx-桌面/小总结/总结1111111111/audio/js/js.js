
var setW = 1000; //?????????????????????width>1000???????????????width<1000???????????
var isScroll = 0; //????????
var winW = $(window).width();
var winH = $(window).height();
var device = 0; //?豸 0 ??????? 1??????
if(winW >= setW){
    device = 0;
}else{
    device = 1;
}
// $(".page1").css("height",winH);
$(".meau").click(function(e){
    if($("#nav").is(":hidden")){
        console.log("b");
        $("#header").addClass("bg1");
    }else{
        console.log("a");
        if(isScroll == 0){
            console.log("c");
            //???????????
            setTimeout(function(){
                $("#header").removeClass("bg1");
            },400)
        }
    }
    $("#nav").slideToggle("400");
    e.stopPropagation();
});

if(device == 1){
    //???????
    $("#nav li").click(function(e){
        $("#nav").slideUp("400");
        if(isScroll == 0){
            //???????????
            $("#header").removeClass("bg1");
        }
        e.stopPropagation();
    });
    $("body").click(function(){
        $("#nav").slideUp("400");
        if(isScroll == 0){
            //???????????
            setTimeout(function(){
                $("#header").removeClass("bg1");
            },400)
        }
        e.stopPropagation();
    });
}

//????????????????????

var headerh = $("#header").height();
var ams = 1;
//?????????;    ???????????
$("#nav li,#page-nav li").click(function(){
    ams = 0;
    $("#nav li").removeClass("active");
    $(this).addClass("active");
    var id = $(this).data("id");
    var obj = $("."+id);
    var t = obj.offset().top;
    try {
        $("html").animate({"scrollTop":(t-headerh)},function(){
            ams = 1;
        });
    }
    catch(err) {

    }
    try {
        $("body").animate({"scrollTop":(t-headerh)},function(){
            ams = 1;
        });
    }
    catch(err) {

    }
    tabActive(id);

});
//    ????????active??
function tabActive(ids){
    var ids = ids;
    $("#nav li").each(function(){
        var This = $(this);
        var id2 = This.data("id");
        if(ids == id2){
            This.addClass("active").siblings().removeClass("active");
        }
    });
}
$(window).scroll(function(){
    //ams ?????0 ????????????????????????????????????????ж?
    if(ams == 1){
        fun();
    }
    //????PC??????????????Ч???PC??????????????????????????????????????????????????PC??header??page1??#page-nav?????
    divShow();
});
function fun(){
    //    section????????????????active
    //    section???????????????-80??ж??????????
    var hasgo = $(window).scrollTop(); //????????????
    var winH = $(window).height(); //???????
    var bodyH = $("body").height(); //?????????
    var offH = 100; //?????

    /*
     * ?? hasgo + winH == bodyH ;?????????????
     * ???????????????????????????????offH??????????????????????????offH??????????????????????????????????????active??
     * ?? hasgo == 0 ;????????????????????
     * ??  hasgoa >= t1 && hasgoa <= t1+t2 ;???????????????????????????
     * ??t1???????????????????????????t2???????????? t1+t2?????????????????????????
     * */
    if(hasgo <= 0+offH){
        //??????????????
        var id = $("#nav li:nth-of-type(1)").data("id");
        isScroll = 0;
        tabActive(id);

    }else if(hasgo + winH >= bodyH-offH){
        isScroll = 1;
        //???????????????????
        var id = $("#nav li:nth-last-of-type(1)").data("id");
        tabActive(id);
    }else{
        isScroll = 1;
        var hasgoa = hasgo+winH/2; //+1/2winH????????????????????????????????????????????
        $("section").each(function(){
            var This = $(this);
            var t1 = This.offset().top; //?????????????
            var t2 = This.height(); //??????
            if(hasgoa >= t1 && hasgoa <= t1+t2){
                var id1 = This.data("id");
                $("#nav li").each(function(){
                    var That = $(this);
                    var id2 = That.data("id");
                    if(id2 == id1){
                        tabActive(id1);
                    }
                })
            }
        })
    }

}

//??????????????????????????飨????????Ч?????????div????????
function divShow(){
    //?????????????????????
    var hasgo = $(window).scrollTop(); //????????????
    var offH = 100; //?????
    var hasgoa = parseInt(hasgo + winH);
    if(hasgo >= winH){
        //????????????????????
        $("#header").addClass("bg1");
    }else{
        //?????????????????????
        if(hasgo >= 50){
            //??????
            $("#header").addClass("bg1");
        }else{
            $("#header").removeClass("bg1");
        }
    }

    if(device == 0){
        //????????????
        $(".needFadeInUp").each(function(i){
            var This = $(this);
            var t1 = This.offset().top; //?????????????
            if(hasgoa >= parseInt(t1+offH) && hasgoa <= parseInt(t1+winH)){
                // console.log("index="+i);
                This.css("opacity","1");
                This.addClass("fadeInUp");
            }
        })
    }
}

//PC???????????????????????????Ч??????????
function hideDiv(){
    $(".needFadeInUp").css("opacity","0");
}
window.onbeforeunload = function(){
    //?????????????????
    document.documentElement.scrollTop = 0;  //ie??
    document.body.scrollTop = 0;  //??ie
};
function loading(){
    if(device == 0){
        //PC
        $("section").each(function(){
            var h = $(this).height();
            $(this).css("height",h);
        });
        hideDiv();
        $(".load").hide();
        // ???????????????????????????????λ??
//            fun();
//            divShow();
    }else{
        //???
        $(".load").hide();
    }

}
window.onload=loading;



// ?????????????????
/**
 * ???href??????
 * name???????????????????
 * **/

function GetHrefVal(name){
    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if(r!=null)return  unescape(r[2]); return null;
}

var page = GetHrefVal("page");
if(page){
    $("#nav li").each(function(){
        var This = $(this);
        var id2 = This.data("id");
        if(page == id2){
            This.click();
        }
    });
}


langTab();
function langTab(){
    //????????
    var hoverState = 1;
    $("#lang span").hover(function(){
        hoverState = 1;
        $(".lang_box").show();
        $(".lang_box").animate({"top":60,"opacity":1});
    },function(){
        hoverState = 0;
        setTimeout(function(){
            if(hoverState == 0){
                $(".lang_box").animate({"top":100,"opacity":0});
                $(".lang_box").hide();
            }
        },200)
    });
    $(".lang_box").hover(function(){
        hoverState = 1;
        $(".lang_box").show();
        $(".lang_box").animate({"top":60,"opacity":1});
    },function(){
        hoverState = 0;
        setTimeout(function(){
            if(hoverState == 0){
                $(".lang_box").animate({"top":100,"opacity":0},function(){
                    $(".lang_box").hide();
                });
            }
        },200)
    });

    $(".lang_box li").click(function(){
        $(this).addClass("on").siblings().removeClass("on");
        var txt = $(this).text();
        $("#lang span").text(txt);
    })
}
//????????????????????
